import pandas as pd
import time

# ê¸°ì¡´ CSV íŒŒì¼ ê²½ë¡œ (product_id ë¦¬ìŠ¤íŠ¸ê°€ ì €ì¥ëœ íŒŒì¼)
input_csv_path = "tenbyten_all_products.csv"

# ìƒˆë¡œìš´ CSV íŒŒì¼ ê²½ë¡œ (ìƒì„¸ ì •ë³´ ì €ì¥)
output_csv_path = "tenbyten_product_details.csv"

# CSV íŒŒì¼ì—ì„œ product_id ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv(input_csv_path, dtype={"product_id": str})  # product_id ë¬¸ìì—´ë¡œ ì½ê¸°
product_id_list = df["product_id"].tolist()

print(f"ğŸ“Œ ì´ {len(product_id_list)}ê°œì˜ ìƒí’ˆ ìƒì„¸ ì •ë³´ë¥¼ í¬ë¡¤ë§í•©ë‹ˆë‹¤...")

# í¬ë¡¤ë§í•œ ë°ì´í„°ë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
detailed_products = []

# ëª¨ë“  product_id ëŒ€í•´ ìƒì„¸ í¬ë¡¤ë§ ì‹¤í–‰
for idx, product_id in enumerate(product_id_list):
    print(f"ğŸ” {idx+1}/{len(product_id_list)}: {product_id} ìƒì„¸ ì •ë³´ í¬ë¡¤ë§ ì¤‘...")
    
    product_data = scrape_view_product_data(product_id)
    
    if product_data:
        detailed_products.append(product_data)

    time.sleep(1)  # ì„œë²„ ë¶€í•˜ ë°©ì§€

# í¬ë¡¤ë§í•œ ë°ì´í„°ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜ í›„ CSV ì €ì¥
df_detailed = pd.DataFrame(detailed_products)
df_detailed.to_csv(output_csv_path, index=False, encoding="utf-8-sig")

print(f"âœ… í¬ë¡¤ë§ ì™„ë£Œ! ğŸ“‚ {output_csv_path} íŒŒì¼ë¡œ ì €ì¥ë¨.")
